<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>4 Advanced Spatial Viz P1 – COMP/STAT212 Portfolio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<link href="../../../../src/appx/appx-sample1.html" rel="next">
<link href="../../../../src/ica/03-adv-ggplot.html" rel="prev">
<script src="../../../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-b53751a350365c71b6c909e95f209ed1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap-463f7e572b85bff0cfe833e89a202fa4.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../../site_libs/bootstrap/bootstrap-dark-2b27489b1280a247593da265a4955406.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script><style>html{ scroll-behavior: smooth; }</style>
<link rel="stylesheet" href="../../../../style/custom.css">
</head>
<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../../src/ica/ica-sample1.html">In-Class Activities</a></li><li class="breadcrumb-item"><a href="../../../../src/ica/04_adv_maps/code/Advanced_maps.html"><span class="chapter-title">4 Advanced Spatial Viz P1</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../../../../index.html" class="sidebar-logo-link">
      <img src="../../../../assets/sidebar-logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none"></a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../../../../">Mohammed Sohail Khan</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Prof Viz</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../src/pv/pv-01.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Professional Viz Sample</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">TidyTuesday</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../src/tt/2025-07-08.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">TidyTuesday Sample 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../src/tt/2025-07-15.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">TidyTuesday Sample 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../src/tt/Homework_01_Intermediate_Data Science.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Homework 01</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">In-Class Activities</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../src/ica/ica-sample1.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">ICA Sample 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../src/ica/ica-sample2.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">ICA Sample 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../src/ica/02-Intermediate-DS-Review.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Cleaning SFO Weather Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../src/ica/03-adv-ggplot.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">3 Advanced Data Viz</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../src/ica/04_adv_maps/code/Advanced_maps.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">4 Advanced Spatial Viz P1</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../src/appx/appx-sample1.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Appendix Sample 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../src/appx/appx-sample2.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Appendix Sample 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../mm/mm.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Mind Maps</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#learning-goals" id="toc-learning-goals" class="nav-link active" data-scroll-target="#learning-goals">🧩 Learning Goals</a></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources">Additional Resources</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li>
<a href="#spatial-data-in-r" id="toc-spatial-data-in-r" class="nav-link" data-scroll-target="#spatial-data-in-r">Spatial Data in R</a>
  <ul class="collapse">
<li><a href="#download-shapefiles" id="toc-download-shapefiles" class="nav-link" data-scroll-target="#download-shapefiles">Download Shapefiles</a></li>
  <li><a href="#read-in-files" id="toc-read-in-files" class="nav-link" data-scroll-target="#read-in-files">Read in Files</a></li>
  <li><a href="#change-crs" id="toc-change-crs" class="nav-link" data-scroll-target="#change-crs">Change CRS</a></li>
  </ul>
</li>
  <li>
<a href="#mn-map-with-multiple-layers" id="toc-mn-map-with-multiple-layers" class="nav-link" data-scroll-target="#mn-map-with-multiple-layers">MN Map with Multiple Layers</a>
  <ul class="collapse">
<li><a href="#get-county-boundaries" id="toc-get-county-boundaries" class="nav-link" data-scroll-target="#get-county-boundaries">Get County Boundaries</a></li>
  <li><a href="#unifying-crss-across-different-spatial-datasets" id="toc-unifying-crss-across-different-spatial-datasets" class="nav-link" data-scroll-target="#unifying-crss-across-different-spatial-datasets">Unifying CRSs Across Different Spatial Datasets</a></li>
  <li><a href="#counties-cities" id="toc-counties-cities" class="nav-link" data-scroll-target="#counties-cities">Counties + Cities</a></li>
  <li><a href="#customize-colors" id="toc-customize-colors" class="nav-link" data-scroll-target="#customize-colors">Customize Colors</a></li>
  <li><a href="#adding-elevation-raster-data" id="toc-adding-elevation-raster-data" class="nav-link" data-scroll-target="#adding-elevation-raster-data">Adding Elevation Raster Data</a></li>
  <li><a href="#zoom-in-to-twin-cities-and-add-water" id="toc-zoom-in-to-twin-cities-and-add-water" class="nav-link" data-scroll-target="#zoom-in-to-twin-cities-and-add-water">Zoom in to Twin Cities and Add Water</a></li>
  </ul>
</li>
  <li><a href="#going-beyond---twin-cities-map-with-leaflet" id="toc-going-beyond---twin-cities-map-with-leaflet" class="nav-link" data-scroll-target="#going-beyond---twin-cities-map-with-leaflet">Going Beyond - Twin Cities Map with <code>leaflet</code></a></li>
  <li><a href="#done" id="toc-done" class="nav-link" data-scroll-target="#done">Done!</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../../src/ica/ica-sample1.html">In-Class Activities</a></li><li class="breadcrumb-item"><a href="../../../../src/ica/04_adv_maps/code/Advanced_maps.html"><span class="chapter-title">4 Advanced Spatial Viz P1</span></a></li></ol></nav><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-title">4 Advanced Spatial Viz P1</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header><section id="learning-goals" class="level2"><h2 class="anchored" data-anchor-id="learning-goals">🧩 Learning Goals</h2>
<p>By the end of this lesson, you should be able to:</p>
<ul>
<li>Understand the basics of a CRS (coordinate reference system)</li>
<li>Understand and recognize different spatial file types and data types in R</li>
<li>Implement some of the basic plotting with the <code>sf</code> package</li>
<li>Understand foundational ideas in working with spatial data (aggregating spatial point data to a spatial region, joining spatial data sets)</li>
</ul></section><section id="additional-resources" class="level2"><h2 class="anchored" data-anchor-id="additional-resources">Additional Resources</h2>
<ul>
<li>Spatial Data Science with Applications in R book: <a href="https://r-spatial.org/book/">web</a>
</li>
<li>Spatial Data Science with R and <code>terra</code> Resources: <a href="https://rspatial.org/">web</a>
</li>
<li>Leaflet in R Package: <a href="https://rstudio.github.io/leaflet/">web</a>
</li>
<li>CRAN task view on spatial analysis: <a href="https://cran.r-project.org/web/views/Spatial.html">web</a>
</li>
</ul></section><section id="setup" class="level2"><h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>For this activity, create the following directory structure in your portfolio repository under <code>src/ica</code> folder:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1"></a>portfolio</span>
<span id="cb1-2"><a href="#cb1-2"></a>└─&nbsp;src</span>
<span id="cb1-3"><a href="#cb1-3"></a>&nbsp;&nbsp;&nbsp;└─&nbsp;ica</span>
<span id="cb1-4"><a href="#cb1-4"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;└─&nbsp;04_adv_maps</span>
<span id="cb1-5"><a href="#cb1-5"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;├─&nbsp;code</span>
<span id="cb1-6"><a href="#cb1-6"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│&nbsp;&nbsp;└─&nbsp;04-adv-maps-1-notes.qmd</span>
<span id="cb1-7"><a href="#cb1-7"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;├─&nbsp;data</span>
<span id="cb1-8"><a href="#cb1-8"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│&nbsp;&nbsp;└─&nbsp;...  ← saving data here during this activity</span>
<span id="cb1-9"><a href="#cb1-9"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;└─&nbsp;figures</span>
<span id="cb1-10"><a href="#cb1-10"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;└─&nbsp;...  ← saving created maps here during this activity</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>First load required packages.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Note to me : This r setup is a name of the code chunk -- setup is codechunk name and r means r code chunk</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co">#Install these packages first</span></span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co"># install.packages(c("sf","elevatr","terra","stars","tidycensus"))</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co"># install.packages('devtools')</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co"># devtools::install_github("ropensci/USAboundaries")</span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co"># install.packages("USAboundariesData", repos = "https://ropensci.r-universe.dev", type = "source")</span></span>
<span id="cb2-8"><a href="#cb2-8"></a></span>
<span id="cb2-9"><a href="#cb2-9"></a></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="fu">library</span>(sf) <span class="co"># tools for working with spatial vector data (GIS functionality, mapping)</span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="fu">library</span>(elevatr) <span class="co"># access to raster elevation maps</span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="fu">library</span>(terra)</span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="fu">library</span>(stars)</span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="fu">library</span>(tidycensus) <span class="co"># spatial data for the US with census information</span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="fu">library</span>(USAboundaries) <span class="co"># access to boundaries for US states, counties, zip codes, and congressional districts </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="spatial-data-in-r" class="level2"><h2 class="anchored" data-anchor-id="spatial-data-in-r">Spatial Data in R</h2>
<p>See <a href="https://hash-mac.github.io/stat212site-f25/notes/spatial-data.html">Spatial Data Appendix</a> for basics of CRS and spatial data types.</p>
<section id="download-shapefiles" class="level3"><h3 class="anchored" data-anchor-id="download-shapefiles">Download Shapefiles</h3>
<ol type="1">
<li>Navigate to the following URLs to download the spatial data files we’ll be using in this activity. Put these files in the <code>data</code> folder of your <code>04_adv_maps</code> folder.</li>
</ol>
<ul>
<li>MN cities: <a href="https://gisdata.mn.gov/dataset/loc-pop-centers" class="uri">https://gisdata.mn.gov/dataset/loc-pop-centers</a>
<ul>
<li>File type: shapefile (<code>.shp</code>)</li>
<li>File name: <code>shp_loc_pop_centers.zip</code> (Unzip this after downloading.)</li>
</ul>
</li>
<li>MN water: <a href="https://gisdata.mn.gov/dataset/us-mn-state-metc-water-lakes-rivers" class="uri">https://gisdata.mn.gov/dataset/us-mn-state-metc-water-lakes-rivers</a>
<ul>
<li>File type: shapefile (<code>.shp</code>)</li>
<li>File name: <code>shp_water_lakes_rivers.zip</code> (Unzip this after downloading.)</li>
</ul>
</li>
</ul></section><section id="read-in-files" class="level3"><h3 class="anchored" data-anchor-id="read-in-files">Read in Files</h3>
<ol start="2" type="1">
<li>Read in the MN cities and MN water shapefiles by entering the correct relative paths in <code>st_read()</code>. <strong>Tab completion will be very helpful here: type part of a directory or file name and hit tab to autocomplete or bring up a dropdown of options.</strong>
</li>
</ol>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># The sf package comes with a North Carolina shapefile:</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>nc <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">system.file</span>(<span class="st">"shape/nc.shp"</span>, <span class="at">package =</span> <span class="st">"sf"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Reading layer `nc' from data source 
  `/Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/library/sf/shape/nc.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 100 features and 14 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965
Geodetic CRS:  NAD27</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Read in shapefiles just downloaded</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>mn_cities <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"../Data/Lakes_and_Rivers_Open_Water_Features/LakesAndRivers.shp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Reading layer `LakesAndRivers' from data source 
  `/Users/mohammedsohailkhan/Desktop/Fall_2025/Intermediate_DS/Portfolio/portfolio-Sohail-44/src/ica/04_adv_maps/Data/Lakes_and_Rivers_Open_Water_Features/LakesAndRivers.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 2313 features and 8 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 419538.6 ymin: 4922700 xmax: 522665 ymax: 5029945
Projected CRS: NAD83 / UTM zone 15N</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>mn_water <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"../Data/Minnesota_Population_Centers/city_and_township_population_centers.shp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Reading layer `city_and_township_population_centers' from data source 
  `/Users/mohammedsohailkhan/Desktop/Fall_2025/Intermediate_DS/Portfolio/portfolio-Sohail-44/src/ica/04_adv_maps/Data/Minnesota_Population_Centers/city_and_township_population_centers.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 1081 features and 8 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 190832.6 ymin: 4816672 xmax: 747463.4 ymax: 5468045
Projected CRS: NAD83 / UTM zone 15N</code></pre>
</div>
</div>
<p>The <code>sf</code> package reads in spatial data in <code>data.frame</code>-like format. Using the <code><a href="https://rdrr.io/r/base/class.html">class()</a></code> function we can check the <strong>class</strong> (type) of object that we just read in. Note the presence of the “sf” and “data.frame” classes:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">class</span>(nc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "data.frame"</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">class</span>(mn_cities)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "data.frame"</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">class</span>(mn_water)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "data.frame"</code></pre>
</div>
</div>
<p>When we read in spatial objects, it is useful to check what CRS underlies the data. We can do that with <code>st_crs()</code> from the <code>sf</code> package:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">st_crs</span>(nc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: NAD27 
  wkt:
GEOGCRS["NAD27",
    DATUM["North American Datum 1927",
        ELLIPSOID["Clarke 1866",6378206.4,294.978698213898,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["latitude",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["longitude",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4267]]</code></pre>
</div>
</div>
<p>We can treat <code>sf</code> objects similarly to ordinary datasets when using <code>ggplot2</code> to make spatial visualizations:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">ggplot</span>(nc) <span class="sc">+</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>    <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"NAD27"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="Advanced_maps_files/figure-html/nc_first_map-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="change-crs" class="level3"><h3 class="anchored" data-anchor-id="change-crs">Change CRS</h3>
<ol start="3" type="1">
<li>Let’s explore how changing the CRS changes the map. The <code>st_transform()</code> function in <code>sf</code> re-expresses a spatial object using a user-supplied CRS. The <code>crs</code> argument takes a string descriptor of the CRS. We can find these descriptors via <a href="https://epsg.io" class="uri">https://epsg.io</a>. In the example below, I searched for “South Carolina”.</li>
</ol>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>nc_transformed <span class="ot">&lt;-</span> nc <span class="sc">|&gt;</span> <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="st">"EPSG:32133"</span>)</span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="fu">st_crs</span>(nc_transformed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:32133 
  wkt:
PROJCRS["NAD83 / South Carolina",
    BASEGEOGCRS["NAD83",
        DATUM["North American Datum 1983",
            ELLIPSOID["GRS 1980",6378137,298.257222101,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4269]],
    CONVERSION["SPCS83 South Carolina zone (meter)",
        METHOD["Lambert Conic Conformal (2SP)",
            ID["EPSG",9802]],
        PARAMETER["Latitude of false origin",31.8333333333333,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8821]],
        PARAMETER["Longitude of false origin",-81,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8822]],
        PARAMETER["Latitude of 1st standard parallel",34.8333333333333,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8823]],
        PARAMETER["Latitude of 2nd standard parallel",32.5,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8824]],
        PARAMETER["Easting at false origin",609600,
            LENGTHUNIT["metre",1],
            ID["EPSG",8826]],
        PARAMETER["Northing at false origin",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8827]]],
    CS[Cartesian,2],
        AXIS["easting (X)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["northing (Y)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["Engineering survey, topographic mapping."],
        AREA["United States (USA) - South Carolina - counties of Abbeville; Aiken; Allendale; Anderson; Bamberg; Barnwell; Beaufort; Berkeley; Calhoun; Charleston; Cherokee; Chester; Chesterfield; Clarendon; Colleton; Darlington; Dillon; Dorchester; Edgefield; Fairfield; Florence; Georgetown; Greenville; Greenwood; Hampton; Horry; Jasper; Kershaw; Lancaster; Laurens; Lee; Lexington; Marion; Marlboro; McCormick; Newberry; Oconee; Orangeburg; Pickens; Richland; Saluda; Spartanburg; Sumter; Union; Williamsburg; York."],
        BBOX[32.05,-83.36,35.21,-78.52]],
    ID["EPSG",32133]]</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu">ggplot</span>(nc_transformed) <span class="sc">+</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>    <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3"></a>    <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="Advanced_maps_files/figure-html/transform_nc-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The goal is to use <a href="https://epsg.io" class="uri">https://epsg.io</a> to <strong>find two CRSs</strong> that result in a North Carolina map that is noticeably different from the original in the NAD27 CRS.</p>
<p>Take a look at the <strong>function</strong> below that re-maps a spatial object using a new CRS.</p>
<ul>
<li>Read through the function to get a sense for how this code works.</li>
<li>
<code>spatial_obj</code> and <code>new_crs</code> are called <strong>arguments</strong> (function <strong>inputs</strong>).
<ul>
<li>Add one more argument called <code>title</code> to this function. Use this input to set the plot title.</li>
</ul>
</li>
<li>Use your function to make two new maps using your chosen CRSs.</li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>transform_and_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(spatial_obj, new_crs, <span class="at">title =</span> <span class="st">'Chicago Map'</span>) {</span>
<span id="cb21-2"><a href="#cb21-2"></a>    spatial_obj <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="#cb21-3"></a>        <span class="fu">st_transform</span>(<span class="at">crs =</span> new_crs) <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="#cb21-4"></a>        <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5"></a>            <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6"></a>            <span class="fu">theme_classic</span>()</span>
<span id="cb21-7"><a href="#cb21-7"></a>  </span>
<span id="cb21-8"><a href="#cb21-8"></a>}</span>
<span id="cb21-9"><a href="#cb21-9"></a></span>
<span id="cb21-10"><a href="#cb21-10"></a><span class="co"># Example usage of this function (using a South Carolina CRS)</span></span>
<span id="cb21-11"><a href="#cb21-11"></a><span class="fu">transform_and_plot</span>(nc, <span class="at">new_crs =</span> <span class="st">"EPSG:32133"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="Advanced_maps_files/figure-html/transform_via_function-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Verify your understanding:</strong> If you had point location data that was not in the NAD27 CRS, what would you expect about the accuracy of how they would be overlaid on the original North Carolina map?</p>
</section></section><section id="mn-map-with-multiple-layers" class="level2"><h2 class="anchored" data-anchor-id="mn-map-with-multiple-layers">MN Map with Multiple Layers</h2>
<p><strong>Goal:</strong> create a map of MN with different layers of information (city point locations, county polygon boundaries, rivers as lines and polygons, and a raster elevation map).</p>
<section id="get-county-boundaries" class="level3"><h3 class="anchored" data-anchor-id="get-county-boundaries">Get County Boundaries</h3>
<ol start="4" type="1">
<li>We’ve already read in city location and water information from external shapefiles. We can access county boundaries with the <code>us_counties()</code> function in the <code>USAboundaries</code> package.</li>
</ol>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># Load country boundaries data as sf object</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>mn_counties <span class="ot">&lt;-</span> USAboundaries<span class="sc">::</span><span class="fu">us_counties</span>(<span class="at">resolution =</span> <span class="st">"high"</span>, <span class="at">states =</span> <span class="st">"Minnesota"</span>)</span>
<span id="cb22-3"><a href="#cb22-3"></a></span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="co"># Take care of duplicate column names (there are two identical "state_name" columns)</span></span>
<span id="cb22-5"><a href="#cb22-5"></a>names_counties <span class="ot">&lt;-</span> <span class="fu">names</span>(mn_counties)</span>
<span id="cb22-6"><a href="#cb22-6"></a><span class="fu">names</span>(mn_counties)[names_counties <span class="sc">==</span> <span class="st">"state_name"</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"state_name1"</span>, <span class="st">"state_name2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="unifying-crss-across-different-spatial-datasets" class="level3"><h3 class="anchored" data-anchor-id="unifying-crss-across-different-spatial-datasets">Unifying CRSs Across Different Spatial Datasets</h3>
<ol start="5" type="1">
<li>We first need to ensure that the CRS is the same for all spatial datasets.</li>
</ol>
<ul>
<li>Check the CRS for the <code>mn_cities</code>, <code>mn_water</code>, and <code>mn_counties</code> datasets.</li>
<li>If the datasets don’t all have the same CRS, use <code>st_transform()</code> to update the datasets to have the same CRS as <code>mn_cities</code>. You can use <code>crs = st_crs(mn_cities)</code> within <code>st_transform()</code>.</li>
</ul></section><section id="counties-cities" class="level3"><h3 class="anchored" data-anchor-id="counties-cities">Counties + Cities</h3>
<ol start="6" type="1">
<li>Create a map where city locations are overlaid on a map of county boundaries.</li>
</ol>
<ul>
<li>You will need to call <code>geom_sf()</code> twice.</li>
<li>Make the map background white.</li>
<li>Install the <code>ggthemes</code> package, and add the following layer to use a clean map theme: <code>+ ggthemes::theme_map()</code>
</li>
</ul></section><section id="customize-colors" class="level3"><h3 class="anchored" data-anchor-id="customize-colors">Customize Colors</h3>
<ol start="7" type="1">
<li>We can use traditional <code>ggplot2</code> aesthetics (e.g., <code>fill</code>, <code>color</code>) to display location specific attributes. Below we only plot large cities, and we color and size cities according to their population.</li>
</ol>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co">#ggplot() +</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>    <span class="co">#geom_sf(data = mn_counties, fill = "white") + </span></span>
<span id="cb23-3"><a href="#cb23-3"></a>    <span class="co">#geom_sf(data = mn_cities |&gt; filter(Population &gt;= 10000), mapping = aes(color = Population, size = Population)) + # cities layer</span></span>
<span id="cb23-4"><a href="#cb23-4"></a>    <span class="co">#scale_color_viridis_c() + # continuous (gradient) color scale</span></span>
<span id="cb23-5"><a href="#cb23-5"></a>    <span class="co">#labs(title = "Minnesota Cities with Population &gt;= 10,000") + </span></span>
<span id="cb23-6"><a href="#cb23-6"></a>    <span class="co">#ggthemes::theme_map() +</span></span>
<span id="cb23-7"><a href="#cb23-7"></a>    <span class="co">#theme(legend.position = "bottom") # move legend</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Look up the <code>scale_color_viridis_c()</code> documentation via the <a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">ggplot2 reference</a>.</p>
<ul>
<li>Read the function description at the top. What is the advantage of using this function for making color palettes?</li>
<li>Look through the examples section. What is the difference between the <code>_d()</code>, <code>_c()</code>, and <code>_b()</code> variants of this function?</li>
</ul></section><section id="adding-elevation-raster-data" class="level3"><h3 class="anchored" data-anchor-id="adding-elevation-raster-data">Adding Elevation Raster Data</h3>
<p>Where are large cities located? Is there some relationship to local geography/terrain?</p>
<ol start="8" type="1">
<li>To investigate these questions, we can obtain elevation data to include on the map using the <code>elevatr</code> package. We encounter two new functions here—we can look up their documentation to make sense of the code by entering the following in the Console:</li>
</ol>
<ul>
<li><code><a href="https://rdrr.io/pkg/elevatr/man/get_elev_raster.html">?elevatr::get_elev_raster</a></code></li>
<li><code><a href="https://rdrr.io/pkg/terra/man/as.data.frame.html">?terra::as.data.frame</a></code></li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co">#elevation &lt;- elevatr::get_elev_raster(mn_counties, z = 5, clip = "bbox")</span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="co">#raster::crs(elevation) &lt;- sf::st_crs(mn_counties)</span></span>
<span id="cb24-3"><a href="#cb24-3"></a></span>
<span id="cb24-4"><a href="#cb24-4"></a><span class="co"># Convert to data frame for plotting</span></span>
<span id="cb24-5"><a href="#cb24-5"></a><span class="co">#elev_df &lt;- elevation |&gt; terra::as.data.frame(xy = TRUE)</span></span>
<span id="cb24-6"><a href="#cb24-6"></a><span class="co">#colnames(elev_df) &lt;- c("x", "y", "elevation")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Build on our existing map by adding a raster layer for elevation as the background.</p>
<ul>
<li>Look up the documentation for <code>geom_raster()</code> to plot the elevation data from <code>elev_df</code>. This will be the first layer of the plot.</li>
<li>Look at the documentation for <code>scale_fill_gradient()</code> to add the following elevation color scale: <code>"darkgreen"</code> represents the lowest elevations, and <code>"white"</code> represents the highest elevations.</li>
<li>Add in the layers from the map above to show the largest cities and the county outlines. To remove a background color, use <code>fill = NA</code>.</li>
</ul></section><section id="zoom-in-to-twin-cities-and-add-water" class="level3"><h3 class="anchored" data-anchor-id="zoom-in-to-twin-cities-and-add-water">Zoom in to Twin Cities and Add Water</h3>
<ol start="9" type="1">
<li>The bulk of the interesting information in this map is in the Twin Cities area. Let’s zoom in to this area.</li>
</ol>
<ul>
<li>We can use the <code>st_bbox()</code> function to get the <strong>bounding box</strong> for a spatial object—we do this after filtering to the 7 counties in the Twin Cities.</li>
<li>We then use <code>st_crop()</code> to trim a spatial object to a given bounding box.</li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>seven_countyarea <span class="ot">&lt;-</span> mn_counties <span class="sc">|&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>    <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Anoka"</span>, <span class="st">"Hennepin"</span>, <span class="st">"Ramsey"</span>, <span class="st">"Dakota"</span>, <span class="st">"Carver"</span>, <span class="st">"Washington"</span>, <span class="st">"Scott"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb25-3"><a href="#cb25-3"></a>    <span class="fu">st_bbox</span>()</span>
<span id="cb25-4"><a href="#cb25-4"></a>seven_countyarea</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>     xmin      ymin      xmax      ymax 
-94.01250  44.47115 -92.73204  45.41480 </code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co">#elevation &lt;- elevatr::get_elev_raster(mn_counties |&gt; st_crop(seven_countyarea), z = 9, clip = "bbox")</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="co">#raster::crs(elevation) &lt;- sf::st_crs(mn_counties)</span></span>
<span id="cb27-3"><a href="#cb27-3"></a></span>
<span id="cb27-4"><a href="#cb27-4"></a><span class="co"># Convert to data frame for plotting</span></span>
<span id="cb27-5"><a href="#cb27-5"></a><span class="co">#elev_df &lt;- elevation |&gt; terra::as.data.frame(xy = TRUE)</span></span>
<span id="cb27-6"><a href="#cb27-6"></a><span class="co">#colnames(elev_df) &lt;- c("x", "y", "elevation")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In the plot below, we add a layer for water information and a <code>coord_sf()</code> layer to restrict the x and y-axis limits to the Twin Cities bounding box. (Without this layer, the map would zoom back out to show all counties and bodies of water).</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="co">#ggplot() +</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>    <span class="co">#geom_raster(data = elev_df, aes(x = x, y = y, fill = elevation)) + </span></span>
<span id="cb28-3"><a href="#cb28-3"></a>    <span class="co">#geom_sf(data = mn_counties, fill = NA, color = "black") + # county boundary layer</span></span>
<span id="cb28-4"><a href="#cb28-4"></a>    <span class="co">#geom_sf(data = mn_water, fill = "lightsteelblue1", color = "lightsteelblue1") + # NEW: river/lake layer</span></span>
<span id="cb28-5"><a href="#cb28-5"></a>    <span class="co">#geom_sf(data = mn_cities |&gt; filter(Population &gt;= 10000), mapping = aes(color = Population, size = Population)) + # cities layer</span></span>
<span id="cb28-6"><a href="#cb28-6"></a>    <span class="co">#scale_color_viridis_c(option = "magma") + # continuous (gradient) color scale</span></span>
<span id="cb28-7"><a href="#cb28-7"></a>    <span class="co">#scale_fill_gradient(low = "darkgreen", high = "white") + # continuous (gradient) fill scale</span></span>
<span id="cb28-8"><a href="#cb28-8"></a>    <span class="co">#coord_sf(xlim = seven_countyarea[c("xmin", "xmax")], ylim = seven_countyarea[c("ymin", "ymax")]) + # NEW: crop map to Twin Cities bounding box</span></span>
<span id="cb28-9"><a href="#cb28-9"></a>    <span class="co">#labs(title = "Twin Cities with Population &gt;= 10,000") + </span></span>
<span id="cb28-10"><a href="#cb28-10"></a>    <span class="co">#ggthemes::theme_map() +</span></span>
<span id="cb28-11"><a href="#cb28-11"></a>    <span class="co">#theme(legend.position = "none") # remove legend</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s add to the above code chunk to save the map above to an image file called <code>tc_map_zoom.png</code> in the <code>figures</code> folder. The code example below shows a general template for saving a plot to file. Choose a reasonable width and height. (There are also <code><a href="https://rdrr.io/r/grDevices/png.html">jpeg()</a></code> and <code><a href="https://rdrr.io/r/grDevices/pdf.html">pdf()</a></code> functions for writing images.)</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co">#png("relative path to image", width = width_in_pixels, height = height_in_pixels)</span></span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="co"># Code for creating plot</span></span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="co">#dev.off()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="going-beyond---twin-cities-map-with-leaflet" class="level2"><h2 class="anchored" data-anchor-id="going-beyond---twin-cities-map-with-leaflet">Going Beyond - Twin Cities Map with <code>leaflet</code>
</h2>
<p>Below we show how to make the MN counties map in the <code>leaflet</code> package.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="co">#library(leaflet)</span></span>
<span id="cb30-2"><a href="#cb30-2"></a></span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="co">#mn_counties_leaf &lt;- mn_counties |&gt; st_transform(4326) # Leaflet expects this CRS for vectors</span></span>
<span id="cb30-4"><a href="#cb30-4"></a><span class="co">#mn_cities_leaf &lt;- mn_cities |&gt; st_transform(4326)</span></span>
<span id="cb30-5"><a href="#cb30-5"></a></span>
<span id="cb30-6"><a href="#cb30-6"></a><span class="co">#cities_per_county &lt;- st_join(mn_cities_leaf, mn_counties_leaf) |&gt;</span></span>
<span id="cb30-7"><a href="#cb30-7"></a>    <span class="co">#st_drop_geometry() |&gt; # removes geometry - makes the following calculation more efficient</span></span>
<span id="cb30-8"><a href="#cb30-8"></a>    <span class="co">#count(name) </span></span>
<span id="cb30-9"><a href="#cb30-9"></a></span>
<span id="cb30-10"><a href="#cb30-10"></a><span class="co">#mn_counties_leaf |&gt; </span></span>
<span id="cb30-11"><a href="#cb30-11"></a>    <span class="co">#filter(name %in% c("Anoka", "Hennepin", "Ramsey", "Dakota", "Carver", "Washington", "Scott")) |&gt;</span></span>
<span id="cb30-12"><a href="#cb30-12"></a>    <span class="co">#left_join(cities_per_county) |&gt;</span></span>
<span id="cb30-13"><a href="#cb30-13"></a>    <span class="co">#leaflet() |&gt; </span></span>
<span id="cb30-14"><a href="#cb30-14"></a>    <span class="co">#addProviderTiles("CartoDB.Positron") |&gt; </span></span>
<span id="cb30-15"><a href="#cb30-15"></a>    <span class="co">#addPolygons(</span></span>
<span id="cb30-16"><a href="#cb30-16"></a>        <span class="co">#color = "#444444", weight = 1, smoothFactor = 0.5, opacity = 1.0,</span></span>
<span id="cb30-17"><a href="#cb30-17"></a>        <span class="co">#fillOpacity = 0.5, fillColor = ~colorQuantile("YlOrRd", n)(n),</span></span>
<span id="cb30-18"><a href="#cb30-18"></a>        <span class="co">#highlightOptions = highlightOptions(color = "white", weight = 2, bringToFront = TRUE)) |&gt;</span></span>
<span id="cb30-19"><a href="#cb30-19"></a>    <span class="co">#addCircles(data = mn_cities_leaf |&gt; filter(County %in% paste(c("Anoka", "Hennepin", "Ramsey", "Dakota", "Carver", "Washington", "Scott"), "County")), color = "#444444")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="done" class="level2"><h2 class="anchored" data-anchor-id="done">Done!</h2>
<ul>
<li>Check the ICA Instructions for how to (a) push your code to GitHub and (b) update your portfolio website</li>
</ul>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation column-body"><div class="nav-page nav-page-previous">
      <a href="../../../../src/ica/03-adv-ggplot.html" class="pagination-link" aria-label="3 Advanced Data Viz">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">3 Advanced Data Viz</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../../../src/appx/appx-sample1.html" class="pagination-link" aria-label="Appendix Sample 1">
        <span class="nav-page-text"><span class="chapter-title">Appendix Sample 1</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb31" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb31-1"><a href="#cb31-1"></a><span class="co">---</span></span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="an">title:</span><span class="co"> "4 Advanced Spatial Viz P1"</span></span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="co">---</span></span>
<span id="cb31-4"><a href="#cb31-4"></a></span>
<span id="cb31-5"><a href="#cb31-5"></a><span class="in">```{r doc_setup, echo=FALSE, message=FALSE}</span></span>
<span id="cb31-6"><a href="#cb31-6"></a><span class="in">#| echo: false</span></span>
<span id="cb31-7"><a href="#cb31-7"></a><span class="in">#| message: false</span></span>
<span id="cb31-8"><a href="#cb31-8"></a></span>
<span id="cb31-9"><a href="#cb31-9"></a><span class="in">library(tidyverse)</span></span>
<span id="cb31-10"><a href="#cb31-10"></a><span class="in">knitr::opts_chunk$set(fig.align = "center", warning = FALSE, message = FALSE)</span></span>
<span id="cb31-11"><a href="#cb31-11"></a><span class="in">```</span></span>
<span id="cb31-12"><a href="#cb31-12"></a></span>
<span id="cb31-13"><a href="#cb31-13"></a></span>
<span id="cb31-14"><a href="#cb31-14"></a><span class="fu">## 🧩 Learning Goals</span></span>
<span id="cb31-15"><a href="#cb31-15"></a></span>
<span id="cb31-16"><a href="#cb31-16"></a>By the end of this lesson, you should be able to:</span>
<span id="cb31-17"><a href="#cb31-17"></a></span>
<span id="cb31-18"><a href="#cb31-18"></a><span class="ss">- </span>Understand the basics of a CRS (coordinate reference system)</span>
<span id="cb31-19"><a href="#cb31-19"></a><span class="ss">- </span>Understand and recognize different spatial file types and data types in R</span>
<span id="cb31-20"><a href="#cb31-20"></a><span class="ss">- </span>Implement some of the basic plotting with the <span class="in">`sf`</span> package</span>
<span id="cb31-21"><a href="#cb31-21"></a><span class="ss">- </span>Understand foundational ideas in working with spatial data (aggregating spatial point data to a spatial region, joining spatial data sets)</span>
<span id="cb31-22"><a href="#cb31-22"></a></span>
<span id="cb31-23"><a href="#cb31-23"></a></span>
<span id="cb31-24"><a href="#cb31-24"></a></span>
<span id="cb31-25"><a href="#cb31-25"></a></span>
<span id="cb31-26"><a href="#cb31-26"></a><span class="fu">## Additional Resources</span></span>
<span id="cb31-27"><a href="#cb31-27"></a></span>
<span id="cb31-28"><a href="#cb31-28"></a><span class="ss">- </span>Spatial Data Science with Applications in R book: <span class="co">[</span><span class="ot">web</span><span class="co">](https://r-spatial.org/book/)</span></span>
<span id="cb31-29"><a href="#cb31-29"></a><span class="ss">- </span>Spatial Data Science with R and <span class="in">`terra`</span> Resources: <span class="co">[</span><span class="ot">web</span><span class="co">]( https://rspatial.org/)</span></span>
<span id="cb31-30"><a href="#cb31-30"></a><span class="ss">- </span>Leaflet in R Package: <span class="co">[</span><span class="ot">web</span><span class="co">](https://rstudio.github.io/leaflet/)</span></span>
<span id="cb31-31"><a href="#cb31-31"></a><span class="ss">- </span>CRAN task view on spatial analysis: <span class="co">[</span><span class="ot">web</span><span class="co">](https://cran.r-project.org/web/views/Spatial.html)</span></span>
<span id="cb31-32"><a href="#cb31-32"></a></span>
<span id="cb31-33"><a href="#cb31-33"></a></span>
<span id="cb31-34"><a href="#cb31-34"></a></span>
<span id="cb31-35"><a href="#cb31-35"></a></span>
<span id="cb31-36"><a href="#cb31-36"></a></span>
<span id="cb31-37"><a href="#cb31-37"></a><span class="fu">## Setup</span></span>
<span id="cb31-38"><a href="#cb31-38"></a></span>
<span id="cb31-39"><a href="#cb31-39"></a>For this activity, create the following directory structure in your portfolio repository under <span class="in">`src/ica`</span> folder:</span>
<span id="cb31-40"><a href="#cb31-40"></a></span>
<span id="cb31-41"><a href="#cb31-41"></a></span>
<span id="cb31-42"><a href="#cb31-42"></a><span class="in">```markdown</span></span>
<span id="cb31-43"><a href="#cb31-43"></a>portfolio</span>
<span id="cb31-44"><a href="#cb31-44"></a>└─&nbsp;src</span>
<span id="cb31-45"><a href="#cb31-45"></a>&nbsp;&nbsp;&nbsp;└─&nbsp;ica</span>
<span id="cb31-46"><a href="#cb31-46"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;└─&nbsp;04_adv_maps</span>
<span id="cb31-47"><a href="#cb31-47"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;├─&nbsp;code</span>
<span id="cb31-48"><a href="#cb31-48"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│&nbsp;&nbsp;└─&nbsp;04-adv-maps-1-notes.qmd</span>
<span id="cb31-49"><a href="#cb31-49"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;├─&nbsp;data</span>
<span id="cb31-50"><a href="#cb31-50"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│&nbsp;&nbsp;└─&nbsp;...  ← saving data here during this activity</span>
<span id="cb31-51"><a href="#cb31-51"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;└─&nbsp;figures</span>
<span id="cb31-52"><a href="#cb31-52"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;└─&nbsp;...  ← saving created maps here during this activity</span>
<span id="cb31-53"><a href="#cb31-53"></a><span class="in">```</span></span>
<span id="cb31-54"><a href="#cb31-54"></a></span>
<span id="cb31-55"><a href="#cb31-55"></a>First load required packages.</span>
<span id="cb31-56"><a href="#cb31-56"></a></span>
<span id="cb31-57"><a href="#cb31-57"></a><span class="in">```{r setup}</span></span>
<span id="cb31-58"><a href="#cb31-58"></a><span class="in"># Note to me : This r setup is a name of the code chunk -- setup is codechunk name and r means r code chunk</span></span>
<span id="cb31-59"><a href="#cb31-59"></a><span class="in">#Install these packages first</span></span>
<span id="cb31-60"><a href="#cb31-60"></a></span>
<span id="cb31-61"><a href="#cb31-61"></a><span class="in"># install.packages(c("sf","elevatr","terra","stars","tidycensus"))</span></span>
<span id="cb31-62"><a href="#cb31-62"></a><span class="in"># install.packages('devtools')</span></span>
<span id="cb31-63"><a href="#cb31-63"></a><span class="in"># devtools::install_github("ropensci/USAboundaries")</span></span>
<span id="cb31-64"><a href="#cb31-64"></a><span class="in"># install.packages("USAboundariesData", repos = "https://ropensci.r-universe.dev", type = "source")</span></span>
<span id="cb31-65"><a href="#cb31-65"></a></span>
<span id="cb31-66"><a href="#cb31-66"></a></span>
<span id="cb31-67"><a href="#cb31-67"></a><span class="in">library(tidyverse)</span></span>
<span id="cb31-68"><a href="#cb31-68"></a><span class="in">library(sf) # tools for working with spatial vector data (GIS functionality, mapping)</span></span>
<span id="cb31-69"><a href="#cb31-69"></a><span class="in">library(elevatr) # access to raster elevation maps</span></span>
<span id="cb31-70"><a href="#cb31-70"></a><span class="in">library(terra)</span></span>
<span id="cb31-71"><a href="#cb31-71"></a><span class="in">library(stars)</span></span>
<span id="cb31-72"><a href="#cb31-72"></a><span class="in">library(tidycensus) # spatial data for the US with census information</span></span>
<span id="cb31-73"><a href="#cb31-73"></a><span class="in">library(USAboundaries) # access to boundaries for US states, counties, zip codes, and congressional districts </span></span>
<span id="cb31-74"><a href="#cb31-74"></a></span>
<span id="cb31-75"><a href="#cb31-75"></a><span class="in">```</span></span>
<span id="cb31-76"><a href="#cb31-76"></a></span>
<span id="cb31-77"><a href="#cb31-77"></a></span>
<span id="cb31-78"><a href="#cb31-78"></a><span class="fu">## Spatial Data in R</span></span>
<span id="cb31-79"><a href="#cb31-79"></a></span>
<span id="cb31-80"><a href="#cb31-80"></a>See <span class="co">[</span><span class="ot">Spatial Data Appendix</span><span class="co">](https://hash-mac.github.io/stat212site-f25/notes/spatial-data.html)</span> for basics of CRS and spatial data types.</span>
<span id="cb31-81"><a href="#cb31-81"></a></span>
<span id="cb31-82"><a href="#cb31-82"></a></span>
<span id="cb31-83"><a href="#cb31-83"></a><span class="fu">### Download Shapefiles</span></span>
<span id="cb31-84"><a href="#cb31-84"></a></span>
<span id="cb31-85"><a href="#cb31-85"></a><span class="ss">1. </span>Navigate to the following URLs to download the spatial data files we'll be using in this activity. Put these files in the <span class="in">`data`</span> folder of your <span class="in">`04_adv_maps`</span> folder.</span>
<span id="cb31-86"><a href="#cb31-86"></a>  </span>
<span id="cb31-87"><a href="#cb31-87"></a><span class="ss">- </span>MN cities: <span class="ot">&lt;https://gisdata.mn.gov/dataset/loc-pop-centers&gt;</span></span>
<span id="cb31-88"><a href="#cb31-88"></a><span class="ss">  - </span>File type: shapefile (<span class="in">`.shp`</span>)</span>
<span id="cb31-89"><a href="#cb31-89"></a><span class="ss">  - </span>File name: <span class="in">`shp_loc_pop_centers.zip`</span> (Unzip this after downloading.)</span>
<span id="cb31-90"><a href="#cb31-90"></a>  </span>
<span id="cb31-91"><a href="#cb31-91"></a><span class="ss">- </span>MN water: <span class="ot">&lt;https://gisdata.mn.gov/dataset/us-mn-state-metc-water-lakes-rivers&gt;</span></span>
<span id="cb31-92"><a href="#cb31-92"></a><span class="ss">  - </span>File type: shapefile (<span class="in">`.shp`</span>)</span>
<span id="cb31-93"><a href="#cb31-93"></a><span class="ss">  - </span>File name: <span class="in">`shp_water_lakes_rivers.zip`</span> (Unzip this after downloading.)</span>
<span id="cb31-94"><a href="#cb31-94"></a></span>
<span id="cb31-95"><a href="#cb31-95"></a></span>
<span id="cb31-96"><a href="#cb31-96"></a></span>
<span id="cb31-97"><a href="#cb31-97"></a><span class="fu">### Read in Files</span></span>
<span id="cb31-98"><a href="#cb31-98"></a></span>
<span id="cb31-99"><a href="#cb31-99"></a><span class="ss">2. </span>Read in the MN cities and MN water shapefiles by entering the correct relative paths in <span class="in">`st_read()`</span>. **Tab completion will be very helpful here: type part of a directory or file name and hit tab to autocomplete or bring up a dropdown of options.**</span>
<span id="cb31-100"><a href="#cb31-100"></a></span>
<span id="cb31-101"><a href="#cb31-101"></a><span class="in">```{r reading}</span></span>
<span id="cb31-102"><a href="#cb31-102"></a><span class="in"># The sf package comes with a North Carolina shapefile:</span></span>
<span id="cb31-103"><a href="#cb31-103"></a><span class="in">nc &lt;- st_read(system.file("shape/nc.shp", package = "sf"))</span></span>
<span id="cb31-104"><a href="#cb31-104"></a></span>
<span id="cb31-105"><a href="#cb31-105"></a><span class="in"># Read in shapefiles just downloaded</span></span>
<span id="cb31-106"><a href="#cb31-106"></a><span class="in">mn_cities &lt;- st_read("../Data/Lakes_and_Rivers_Open_Water_Features/LakesAndRivers.shp")</span></span>
<span id="cb31-107"><a href="#cb31-107"></a><span class="in">mn_water &lt;- st_read("../Data/Minnesota_Population_Centers/city_and_township_population_centers.shp")</span></span>
<span id="cb31-108"><a href="#cb31-108"></a><span class="in">```</span></span>
<span id="cb31-109"><a href="#cb31-109"></a></span>
<span id="cb31-110"><a href="#cb31-110"></a>The <span class="in">`sf`</span> package reads in spatial data in <span class="in">`data.frame`</span>-like format. Using the <span class="in">`class()`</span> function we can check the **class** (type) of object that we just read in. Note the presence of the "sf" and "data.frame" classes:</span>
<span id="cb31-111"><a href="#cb31-111"></a></span>
<span id="cb31-112"><a href="#cb31-112"></a><span class="in">```{r check_class_sf} </span></span>
<span id="cb31-113"><a href="#cb31-113"></a><span class="in">class(nc)</span></span>
<span id="cb31-114"><a href="#cb31-114"></a><span class="in">class(mn_cities)</span></span>
<span id="cb31-115"><a href="#cb31-115"></a><span class="in">class(mn_water)</span></span>
<span id="cb31-116"><a href="#cb31-116"></a><span class="in">```</span></span>
<span id="cb31-117"><a href="#cb31-117"></a></span>
<span id="cb31-118"><a href="#cb31-118"></a></span>
<span id="cb31-119"><a href="#cb31-119"></a></span>
<span id="cb31-120"><a href="#cb31-120"></a></span>
<span id="cb31-121"><a href="#cb31-121"></a>When we read in spatial objects, it is useful to check what CRS underlies the data. We can do that with <span class="in">`st_crs()`</span> from the <span class="in">`sf`</span> package:</span>
<span id="cb31-122"><a href="#cb31-122"></a></span>
<span id="cb31-123"><a href="#cb31-123"></a><span class="in">```{r check_nc_crs}</span></span>
<span id="cb31-124"><a href="#cb31-124"></a><span class="in">st_crs(nc)</span></span>
<span id="cb31-125"><a href="#cb31-125"></a><span class="in">```</span></span>
<span id="cb31-126"><a href="#cb31-126"></a></span>
<span id="cb31-127"><a href="#cb31-127"></a>We can treat <span class="in">`sf`</span> objects similarly to ordinary datasets when using <span class="in">`ggplot2`</span> to make spatial visualizations:</span>
<span id="cb31-128"><a href="#cb31-128"></a></span>
<span id="cb31-129"><a href="#cb31-129"></a><span class="in">```{r nc_first_map}</span></span>
<span id="cb31-130"><a href="#cb31-130"></a><span class="in">ggplot(nc) +</span></span>
<span id="cb31-131"><a href="#cb31-131"></a><span class="in">    geom_sf() +</span></span>
<span id="cb31-132"><a href="#cb31-132"></a><span class="in">    theme_classic() +</span></span>
<span id="cb31-133"><a href="#cb31-133"></a><span class="in">    labs(title = "NAD27")</span></span>
<span id="cb31-134"><a href="#cb31-134"></a><span class="in">```</span></span>
<span id="cb31-135"><a href="#cb31-135"></a></span>
<span id="cb31-136"><a href="#cb31-136"></a></span>
<span id="cb31-137"><a href="#cb31-137"></a><span class="fu">### Change CRS</span></span>
<span id="cb31-138"><a href="#cb31-138"></a></span>
<span id="cb31-139"><a href="#cb31-139"></a><span class="ss">3. </span>Let's explore how changing the CRS changes the map. The <span class="in">`st_transform()`</span> function in <span class="in">`sf`</span> re-expresses a spatial object using a user-supplied CRS. The <span class="in">`crs`</span> argument takes a string descriptor of the CRS. We can find these descriptors via <span class="ot">&lt;https://epsg.io&gt;</span>. In the example below, I searched for "South Carolina".</span>
<span id="cb31-140"><a href="#cb31-140"></a></span>
<span id="cb31-141"><a href="#cb31-141"></a><span class="in">```{r transform_nc}</span></span>
<span id="cb31-142"><a href="#cb31-142"></a><span class="in">nc_transformed &lt;- nc |&gt; st_transform(crs = "EPSG:32133")</span></span>
<span id="cb31-143"><a href="#cb31-143"></a><span class="in">st_crs(nc_transformed)</span></span>
<span id="cb31-144"><a href="#cb31-144"></a><span class="in">ggplot(nc_transformed) +</span></span>
<span id="cb31-145"><a href="#cb31-145"></a><span class="in">    geom_sf() +</span></span>
<span id="cb31-146"><a href="#cb31-146"></a><span class="in">    theme_classic()</span></span>
<span id="cb31-147"><a href="#cb31-147"></a><span class="in">```</span></span>
<span id="cb31-148"><a href="#cb31-148"></a></span>
<span id="cb31-149"><a href="#cb31-149"></a>The goal is to use <span class="ot">&lt;https://epsg.io&gt;</span> to **find two CRSs** that result in a North Carolina map that is noticeably different from the original in the NAD27 CRS.</span>
<span id="cb31-150"><a href="#cb31-150"></a></span>
<span id="cb31-151"><a href="#cb31-151"></a>Take a look at the **function** below that re-maps a spatial object using a new CRS.</span>
<span id="cb31-152"><a href="#cb31-152"></a></span>
<span id="cb31-153"><a href="#cb31-153"></a><span class="ss">- </span>Read through the function to get a sense for how this code works.</span>
<span id="cb31-154"><a href="#cb31-154"></a><span class="ss">- </span><span class="in">`spatial_obj`</span> and <span class="in">`new_crs`</span> are called **arguments** (function **inputs**).</span>
<span id="cb31-155"><a href="#cb31-155"></a><span class="ss">    - </span>Add one more argument called <span class="in">`title`</span> to this function. Use this input to set the plot title.</span>
<span id="cb31-156"><a href="#cb31-156"></a><span class="ss">- </span>Use your function to make two new maps using your chosen CRSs.</span>
<span id="cb31-157"><a href="#cb31-157"></a></span>
<span id="cb31-158"><a href="#cb31-158"></a><span class="in">```{r transform_via_function}</span></span>
<span id="cb31-159"><a href="#cb31-159"></a><span class="in">transform_and_plot &lt;- function(spatial_obj, new_crs, title = 'Chicago Map') {</span></span>
<span id="cb31-160"><a href="#cb31-160"></a><span class="in">    spatial_obj %&gt;% </span></span>
<span id="cb31-161"><a href="#cb31-161"></a><span class="in">        st_transform(crs = new_crs) %&gt;% </span></span>
<span id="cb31-162"><a href="#cb31-162"></a><span class="in">        ggplot() +</span></span>
<span id="cb31-163"><a href="#cb31-163"></a><span class="in">            geom_sf() +</span></span>
<span id="cb31-164"><a href="#cb31-164"></a><span class="in">            theme_classic()</span></span>
<span id="cb31-165"><a href="#cb31-165"></a><span class="in">  </span></span>
<span id="cb31-166"><a href="#cb31-166"></a><span class="in">}</span></span>
<span id="cb31-167"><a href="#cb31-167"></a></span>
<span id="cb31-168"><a href="#cb31-168"></a><span class="in"># Example usage of this function (using a South Carolina CRS)</span></span>
<span id="cb31-169"><a href="#cb31-169"></a><span class="in">transform_and_plot(nc, new_crs = "EPSG:32133")</span></span>
<span id="cb31-170"><a href="#cb31-170"></a></span>
<span id="cb31-171"><a href="#cb31-171"></a></span>
<span id="cb31-172"><a href="#cb31-172"></a></span>
<span id="cb31-173"><a href="#cb31-173"></a><span class="in">```</span></span>
<span id="cb31-174"><a href="#cb31-174"></a></span>
<span id="cb31-175"><a href="#cb31-175"></a>**Verify your understanding:** If you had point location data that was not in the NAD27 CRS, what would you expect about the accuracy of how they would be overlaid on the original North Carolina map?</span>
<span id="cb31-176"><a href="#cb31-176"></a></span>
<span id="cb31-177"><a href="#cb31-177"></a></span>
<span id="cb31-178"><a href="#cb31-178"></a><span class="fu">## MN Map with Multiple Layers</span></span>
<span id="cb31-179"><a href="#cb31-179"></a></span>
<span id="cb31-180"><a href="#cb31-180"></a>**Goal:** create a map of MN with different layers of information (city point locations, county polygon boundaries, rivers as lines and polygons, and a raster elevation map).</span>
<span id="cb31-181"><a href="#cb31-181"></a></span>
<span id="cb31-182"><a href="#cb31-182"></a><span class="fu">### Get County Boundaries</span></span>
<span id="cb31-183"><a href="#cb31-183"></a></span>
<span id="cb31-184"><a href="#cb31-184"></a><span class="ss">4. </span>We've already read in city location and water information from external shapefiles. We can access county boundaries with the <span class="in">`us_counties()`</span> function in the <span class="in">`USAboundaries`</span> package.</span>
<span id="cb31-185"><a href="#cb31-185"></a></span>
<span id="cb31-186"><a href="#cb31-186"></a><span class="in">```{r read_county_data}</span></span>
<span id="cb31-187"><a href="#cb31-187"></a><span class="in"># Load country boundaries data as sf object</span></span>
<span id="cb31-188"><a href="#cb31-188"></a><span class="in">mn_counties &lt;- USAboundaries::us_counties(resolution = "high", states = "Minnesota")</span></span>
<span id="cb31-189"><a href="#cb31-189"></a></span>
<span id="cb31-190"><a href="#cb31-190"></a><span class="in"># Take care of duplicate column names (there are two identical "state_name" columns)</span></span>
<span id="cb31-191"><a href="#cb31-191"></a><span class="in">names_counties &lt;- names(mn_counties)</span></span>
<span id="cb31-192"><a href="#cb31-192"></a><span class="in">names(mn_counties)[names_counties == "state_name"] &lt;- c("state_name1", "state_name2")</span></span>
<span id="cb31-193"><a href="#cb31-193"></a><span class="in">```</span></span>
<span id="cb31-194"><a href="#cb31-194"></a></span>
<span id="cb31-195"><a href="#cb31-195"></a></span>
<span id="cb31-196"><a href="#cb31-196"></a><span class="fu">### Unifying CRSs Across Different Spatial Datasets</span></span>
<span id="cb31-197"><a href="#cb31-197"></a></span>
<span id="cb31-198"><a href="#cb31-198"></a><span class="ss">5. </span>We first need to ensure that the CRS is the same for all spatial datasets.</span>
<span id="cb31-199"><a href="#cb31-199"></a></span>
<span id="cb31-200"><a href="#cb31-200"></a><span class="ss">- </span>Check the CRS for the <span class="in">`mn_cities`</span>, <span class="in">`mn_water`</span>, and <span class="in">`mn_counties`</span> datasets.</span>
<span id="cb31-201"><a href="#cb31-201"></a><span class="ss">- </span>If the datasets don't all have the same CRS, use <span class="in">`st_transform()`</span> to update the datasets to have the same CRS as <span class="in">`mn_cities`</span>. You can use <span class="in">`crs = st_crs(mn_cities)`</span> within <span class="in">`st_transform()`</span>.</span>
<span id="cb31-202"><a href="#cb31-202"></a></span>
<span id="cb31-205"><a href="#cb31-205"></a><span class="in">```{r}</span></span>
<span id="cb31-206"><a href="#cb31-206"></a><span class="in">```</span></span>
<span id="cb31-207"><a href="#cb31-207"></a></span>
<span id="cb31-208"><a href="#cb31-208"></a></span>
<span id="cb31-209"><a href="#cb31-209"></a><span class="fu">### Counties + Cities</span></span>
<span id="cb31-210"><a href="#cb31-210"></a></span>
<span id="cb31-211"><a href="#cb31-211"></a><span class="ss">6. </span>Create a map where city locations are overlaid on a map of county boundaries.</span>
<span id="cb31-212"><a href="#cb31-212"></a></span>
<span id="cb31-213"><a href="#cb31-213"></a><span class="ss">- </span>You will need to call <span class="in">`geom_sf()`</span> twice.</span>
<span id="cb31-214"><a href="#cb31-214"></a><span class="ss">- </span>Make the map background white.</span>
<span id="cb31-215"><a href="#cb31-215"></a><span class="ss">- </span>Install the <span class="in">`ggthemes`</span> package, and add the following layer to use a clean map theme: <span class="in">`+ ggthemes::theme_map()`</span></span>
<span id="cb31-216"><a href="#cb31-216"></a></span>
<span id="cb31-219"><a href="#cb31-219"></a><span class="in">```{r}</span></span>
<span id="cb31-220"><a href="#cb31-220"></a><span class="in">```</span></span>
<span id="cb31-221"><a href="#cb31-221"></a></span>
<span id="cb31-222"><a href="#cb31-222"></a></span>
<span id="cb31-223"><a href="#cb31-223"></a></span>
<span id="cb31-224"><a href="#cb31-224"></a><span class="fu">### Customize Colors</span></span>
<span id="cb31-225"><a href="#cb31-225"></a></span>
<span id="cb31-226"><a href="#cb31-226"></a><span class="ss">7. </span>We can use traditional <span class="in">`ggplot2`</span> aesthetics (e.g., <span class="in">`fill`</span>, <span class="in">`color`</span>) to display location specific attributes. Below we only plot large cities, and we color and size cities according to their population.</span>
<span id="cb31-227"><a href="#cb31-227"></a></span>
<span id="cb31-228"><a href="#cb31-228"></a><span class="in">```{r mn_map_add_color}</span></span>
<span id="cb31-229"><a href="#cb31-229"></a><span class="in">#ggplot() +</span></span>
<span id="cb31-230"><a href="#cb31-230"></a><span class="in">    #geom_sf(data = mn_counties, fill = "white") + </span></span>
<span id="cb31-231"><a href="#cb31-231"></a><span class="in">    #geom_sf(data = mn_cities |&gt; filter(Population &gt;= 10000), mapping = aes(color = Population, size = Population)) + # cities layer</span></span>
<span id="cb31-232"><a href="#cb31-232"></a><span class="in">    #scale_color_viridis_c() + # continuous (gradient) color scale</span></span>
<span id="cb31-233"><a href="#cb31-233"></a><span class="in">    #labs(title = "Minnesota Cities with Population &gt;= 10,000") + </span></span>
<span id="cb31-234"><a href="#cb31-234"></a><span class="in">    #ggthemes::theme_map() +</span></span>
<span id="cb31-235"><a href="#cb31-235"></a><span class="in">    #theme(legend.position = "bottom") # move legend</span></span>
<span id="cb31-236"><a href="#cb31-236"></a><span class="in">```</span></span>
<span id="cb31-237"><a href="#cb31-237"></a></span>
<span id="cb31-238"><a href="#cb31-238"></a>Look up the <span class="in">`scale_color_viridis_c()`</span> documentation via the <span class="co">[</span><span class="ot">ggplot2 reference</span><span class="co">](https://ggplot2.tidyverse.org/reference/scale_viridis.html)</span>.</span>
<span id="cb31-239"><a href="#cb31-239"></a></span>
<span id="cb31-240"><a href="#cb31-240"></a><span class="ss">- </span>Read the function description at the top. What is the advantage of using this function for making color palettes?</span>
<span id="cb31-241"><a href="#cb31-241"></a><span class="ss">- </span>Look through the examples section. What is the difference between the <span class="in">`_d()`</span>, <span class="in">`_c()`</span>, and <span class="in">`_b()`</span> variants of this function?</span>
<span id="cb31-242"><a href="#cb31-242"></a></span>
<span id="cb31-243"><a href="#cb31-243"></a></span>
<span id="cb31-244"><a href="#cb31-244"></a></span>
<span id="cb31-245"><a href="#cb31-245"></a></span>
<span id="cb31-246"><a href="#cb31-246"></a><span class="fu">### Adding Elevation Raster Data</span></span>
<span id="cb31-247"><a href="#cb31-247"></a></span>
<span id="cb31-248"><a href="#cb31-248"></a>Where are large cities located? Is there some relationship to local geography/terrain? </span>
<span id="cb31-249"><a href="#cb31-249"></a></span>
<span id="cb31-250"><a href="#cb31-250"></a><span class="ss">8. </span>To investigate these questions, we can obtain elevation data to include on the map using the <span class="in">`elevatr`</span> package. We encounter two new functions here---we can look up their documentation to make sense of the code by entering the following in the Console:</span>
<span id="cb31-251"><a href="#cb31-251"></a></span>
<span id="cb31-252"><a href="#cb31-252"></a><span class="ss">- </span><span class="in">`?elevatr::get_elev_raster`</span></span>
<span id="cb31-253"><a href="#cb31-253"></a><span class="ss">- </span><span class="in">`?terra::as.data.frame`</span></span>
<span id="cb31-254"><a href="#cb31-254"></a></span>
<span id="cb31-255"><a href="#cb31-255"></a><span class="in">```{r get_elevation_data_zoom_out}</span></span>
<span id="cb31-256"><a href="#cb31-256"></a><span class="in">#elevation &lt;- elevatr::get_elev_raster(mn_counties, z = 5, clip = "bbox")</span></span>
<span id="cb31-257"><a href="#cb31-257"></a><span class="in">#raster::crs(elevation) &lt;- sf::st_crs(mn_counties)</span></span>
<span id="cb31-258"><a href="#cb31-258"></a></span>
<span id="cb31-259"><a href="#cb31-259"></a><span class="in"># Convert to data frame for plotting</span></span>
<span id="cb31-260"><a href="#cb31-260"></a><span class="in">#elev_df &lt;- elevation |&gt; terra::as.data.frame(xy = TRUE)</span></span>
<span id="cb31-261"><a href="#cb31-261"></a><span class="in">#colnames(elev_df) &lt;- c("x", "y", "elevation")</span></span>
<span id="cb31-262"><a href="#cb31-262"></a><span class="in">```</span></span>
<span id="cb31-263"><a href="#cb31-263"></a></span>
<span id="cb31-264"><a href="#cb31-264"></a>Build on our existing map by adding a raster layer for elevation as the background.</span>
<span id="cb31-265"><a href="#cb31-265"></a></span>
<span id="cb31-266"><a href="#cb31-266"></a><span class="ss">- </span>Look up the documentation for <span class="in">`geom_raster()`</span> to plot the elevation data from <span class="in">`elev_df`</span>. This will be the first layer of the plot.</span>
<span id="cb31-267"><a href="#cb31-267"></a><span class="ss">- </span>Look at the documentation for <span class="in">`scale_fill_gradient()`</span> to add the following elevation color scale: <span class="in">`"darkgreen"`</span> represents the lowest elevations, and <span class="in">`"white"`</span> represents the highest elevations.</span>
<span id="cb31-268"><a href="#cb31-268"></a><span class="ss">- </span>Add in the layers from the map above to show the largest cities and the county outlines. To remove a background color, use <span class="in">`fill = NA`</span>.</span>
<span id="cb31-269"><a href="#cb31-269"></a></span>
<span id="cb31-272"><a href="#cb31-272"></a><span class="in">```{r}</span></span>
<span id="cb31-273"><a href="#cb31-273"></a><span class="in">```</span></span>
<span id="cb31-274"><a href="#cb31-274"></a></span>
<span id="cb31-275"><a href="#cb31-275"></a></span>
<span id="cb31-276"><a href="#cb31-276"></a></span>
<span id="cb31-277"><a href="#cb31-277"></a><span class="fu">### Zoom in to Twin Cities and Add Water</span></span>
<span id="cb31-278"><a href="#cb31-278"></a></span>
<span id="cb31-279"><a href="#cb31-279"></a><span class="ss">9. </span>The bulk of the interesting information in this map is in the Twin Cities area. Let's zoom in to this area.</span>
<span id="cb31-280"><a href="#cb31-280"></a></span>
<span id="cb31-281"><a href="#cb31-281"></a><span class="ss">- </span>We can use the <span class="in">`st_bbox()`</span> function to get the **bounding box** for a spatial object---we do this after filtering to the 7 counties in the Twin Cities.</span>
<span id="cb31-282"><a href="#cb31-282"></a><span class="ss">- </span>We then use <span class="in">`st_crop()`</span> to trim a spatial object to a given bounding box.</span>
<span id="cb31-283"><a href="#cb31-283"></a></span>
<span id="cb31-284"><a href="#cb31-284"></a><span class="in">```{r get_elevation_data_zoom_in}</span></span>
<span id="cb31-285"><a href="#cb31-285"></a><span class="in">seven_countyarea &lt;- mn_counties |&gt;</span></span>
<span id="cb31-286"><a href="#cb31-286"></a><span class="in">    filter(name %in% c("Anoka", "Hennepin", "Ramsey", "Dakota", "Carver", "Washington", "Scott")) |&gt; </span></span>
<span id="cb31-287"><a href="#cb31-287"></a><span class="in">    st_bbox()</span></span>
<span id="cb31-288"><a href="#cb31-288"></a><span class="in">seven_countyarea</span></span>
<span id="cb31-289"><a href="#cb31-289"></a></span>
<span id="cb31-290"><a href="#cb31-290"></a><span class="in">#elevation &lt;- elevatr::get_elev_raster(mn_counties |&gt; st_crop(seven_countyarea), z = 9, clip = "bbox")</span></span>
<span id="cb31-291"><a href="#cb31-291"></a><span class="in">#raster::crs(elevation) &lt;- sf::st_crs(mn_counties)</span></span>
<span id="cb31-292"><a href="#cb31-292"></a></span>
<span id="cb31-293"><a href="#cb31-293"></a><span class="in"># Convert to data frame for plotting</span></span>
<span id="cb31-294"><a href="#cb31-294"></a><span class="in">#elev_df &lt;- elevation |&gt; terra::as.data.frame(xy = TRUE)</span></span>
<span id="cb31-295"><a href="#cb31-295"></a><span class="in">#colnames(elev_df) &lt;- c("x", "y", "elevation")</span></span>
<span id="cb31-296"><a href="#cb31-296"></a><span class="in">```</span></span>
<span id="cb31-297"><a href="#cb31-297"></a></span>
<span id="cb31-298"><a href="#cb31-298"></a>In the plot below, we add a layer for water information and a <span class="in">`coord_sf()`</span> layer to restrict the x and y-axis limits to the Twin Cities bounding box. (Without this layer, the map would zoom back out to show all counties and bodies of water).</span>
<span id="cb31-299"><a href="#cb31-299"></a></span>
<span id="cb31-300"><a href="#cb31-300"></a><span class="in">```{r elevation_map_zoom_in}</span></span>
<span id="cb31-301"><a href="#cb31-301"></a><span class="in">#ggplot() +</span></span>
<span id="cb31-302"><a href="#cb31-302"></a><span class="in">    #geom_raster(data = elev_df, aes(x = x, y = y, fill = elevation)) + </span></span>
<span id="cb31-303"><a href="#cb31-303"></a><span class="in">    #geom_sf(data = mn_counties, fill = NA, color = "black") + # county boundary layer</span></span>
<span id="cb31-304"><a href="#cb31-304"></a><span class="in">    #geom_sf(data = mn_water, fill = "lightsteelblue1", color = "lightsteelblue1") + # NEW: river/lake layer</span></span>
<span id="cb31-305"><a href="#cb31-305"></a><span class="in">    #geom_sf(data = mn_cities |&gt; filter(Population &gt;= 10000), mapping = aes(color = Population, size = Population)) + # cities layer</span></span>
<span id="cb31-306"><a href="#cb31-306"></a><span class="in">    #scale_color_viridis_c(option = "magma") + # continuous (gradient) color scale</span></span>
<span id="cb31-307"><a href="#cb31-307"></a><span class="in">    #scale_fill_gradient(low = "darkgreen", high = "white") + # continuous (gradient) fill scale</span></span>
<span id="cb31-308"><a href="#cb31-308"></a><span class="in">    #coord_sf(xlim = seven_countyarea[c("xmin", "xmax")], ylim = seven_countyarea[c("ymin", "ymax")]) + # NEW: crop map to Twin Cities bounding box</span></span>
<span id="cb31-309"><a href="#cb31-309"></a><span class="in">    #labs(title = "Twin Cities with Population &gt;= 10,000") + </span></span>
<span id="cb31-310"><a href="#cb31-310"></a><span class="in">    #ggthemes::theme_map() +</span></span>
<span id="cb31-311"><a href="#cb31-311"></a><span class="in">    #theme(legend.position = "none") # remove legend</span></span>
<span id="cb31-312"><a href="#cb31-312"></a><span class="in">```</span></span>
<span id="cb31-313"><a href="#cb31-313"></a></span>
<span id="cb31-314"><a href="#cb31-314"></a>Let's add to the above code chunk to save the map above to an image file called <span class="in">`tc_map_zoom.png`</span> in the <span class="in">`figures`</span> folder. The code example below shows a general template for saving a plot to file. Choose a reasonable width and height. (There are also <span class="in">`jpeg()`</span> and <span class="in">`pdf()`</span> functions for writing images.)</span>
<span id="cb31-315"><a href="#cb31-315"></a></span>
<span id="cb31-316"><a href="#cb31-316"></a><span class="in">```{r save_plot_example, eval=FALSE}</span></span>
<span id="cb31-317"><a href="#cb31-317"></a><span class="in">#png("relative path to image", width = width_in_pixels, height = height_in_pixels)</span></span>
<span id="cb31-318"><a href="#cb31-318"></a><span class="in"># Code for creating plot</span></span>
<span id="cb31-319"><a href="#cb31-319"></a><span class="in">#dev.off()</span></span>
<span id="cb31-320"><a href="#cb31-320"></a><span class="in">```</span></span>
<span id="cb31-321"><a href="#cb31-321"></a></span>
<span id="cb31-322"><a href="#cb31-322"></a></span>
<span id="cb31-323"><a href="#cb31-323"></a><span class="fu">## Going Beyond - Twin Cities Map with `leaflet`</span></span>
<span id="cb31-324"><a href="#cb31-324"></a></span>
<span id="cb31-325"><a href="#cb31-325"></a>Below we show how to make the MN counties map in the <span class="in">`leaflet`</span> package.</span>
<span id="cb31-326"><a href="#cb31-326"></a></span>
<span id="cb31-327"><a href="#cb31-327"></a><span class="in">```{r leaflet}</span></span>
<span id="cb31-328"><a href="#cb31-328"></a><span class="in">#library(leaflet)</span></span>
<span id="cb31-329"><a href="#cb31-329"></a></span>
<span id="cb31-330"><a href="#cb31-330"></a><span class="in">#mn_counties_leaf &lt;- mn_counties |&gt; st_transform(4326) # Leaflet expects this CRS for vectors</span></span>
<span id="cb31-331"><a href="#cb31-331"></a><span class="in">#mn_cities_leaf &lt;- mn_cities |&gt; st_transform(4326)</span></span>
<span id="cb31-332"><a href="#cb31-332"></a></span>
<span id="cb31-333"><a href="#cb31-333"></a><span class="in">#cities_per_county &lt;- st_join(mn_cities_leaf, mn_counties_leaf) |&gt;</span></span>
<span id="cb31-334"><a href="#cb31-334"></a><span class="in">    #st_drop_geometry() |&gt; # removes geometry - makes the following calculation more efficient</span></span>
<span id="cb31-335"><a href="#cb31-335"></a><span class="in">    #count(name) </span></span>
<span id="cb31-336"><a href="#cb31-336"></a></span>
<span id="cb31-337"><a href="#cb31-337"></a><span class="in">#mn_counties_leaf |&gt; </span></span>
<span id="cb31-338"><a href="#cb31-338"></a><span class="in">    #filter(name %in% c("Anoka", "Hennepin", "Ramsey", "Dakota", "Carver", "Washington", "Scott")) |&gt;</span></span>
<span id="cb31-339"><a href="#cb31-339"></a><span class="in">    #left_join(cities_per_county) |&gt;</span></span>
<span id="cb31-340"><a href="#cb31-340"></a><span class="in">    #leaflet() |&gt; </span></span>
<span id="cb31-341"><a href="#cb31-341"></a><span class="in">    #addProviderTiles("CartoDB.Positron") |&gt; </span></span>
<span id="cb31-342"><a href="#cb31-342"></a><span class="in">    #addPolygons(</span></span>
<span id="cb31-343"><a href="#cb31-343"></a><span class="in">        #color = "#444444", weight = 1, smoothFactor = 0.5, opacity = 1.0,</span></span>
<span id="cb31-344"><a href="#cb31-344"></a><span class="in">        #fillOpacity = 0.5, fillColor = ~colorQuantile("YlOrRd", n)(n),</span></span>
<span id="cb31-345"><a href="#cb31-345"></a><span class="in">        #highlightOptions = highlightOptions(color = "white", weight = 2, bringToFront = TRUE)) |&gt;</span></span>
<span id="cb31-346"><a href="#cb31-346"></a><span class="in">    #addCircles(data = mn_cities_leaf |&gt; filter(County %in% paste(c("Anoka", "Hennepin", "Ramsey", "Dakota", "Carver", "Washington", "Scott"), "County")), color = "#444444")</span></span>
<span id="cb31-347"><a href="#cb31-347"></a><span class="in">```</span></span>
<span id="cb31-348"><a href="#cb31-348"></a></span>
<span id="cb31-349"><a href="#cb31-349"></a></span>
<span id="cb31-350"><a href="#cb31-350"></a><span class="fu">## Done!</span></span>
<span id="cb31-351"><a href="#cb31-351"></a></span>
<span id="cb31-352"><a href="#cb31-352"></a><span class="ss">- </span>Check the ICA Instructions for how to (a) push your code to GitHub and (b) update your portfolio website</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>


<script src="../../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>